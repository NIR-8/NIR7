<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vemagal Quick-Mart</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="manifest" href="manifest.json">
</head>

<body class="bg-gray-100 font-sans">

<!-- HEADER -->
<header class="bg-yellow-400 p-4 flex justify-between items-center shadow-md sticky top-0 z-50">
  <h1 class="text-lg md:text-2xl font-bold">üõí Vemagal Quick-Mart</h1>
  <button onclick="toggleCart()" 
    class="bg-black text-white px-4 py-2 rounded-full text-sm md:text-base">
    Cart (<span id="cartCount">0</span>)
  </button>
</header>

<!-- SEARCH -->
<div class="p-3 bg-white shadow-sm">
  <input id="searchInput" type="text" 
    placeholder="Search groceries..."
    class="w-full p-3 border rounded-lg">
</div>

<!-- CATEGORY CHIPS -->
<div id="categoryChips" class="flex overflow-x-auto gap-2 p-3 bg-white"></div>

<!-- PRODUCT GRID -->
<main id="productGrid"
  class="p-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 pb-24">
</main>

<!-- MOBILE CHECKOUT BAR -->
<div class="fixed bottom-0 left-0 right-0 bg-white shadow-lg p-3 flex justify-between items-center md:hidden">
  <span class="font-bold">‚Çπ<span id="mobileTotal">0</span></span>
  <button onclick="toggleCart()" 
    class="bg-green-600 text-white px-5 py-2 rounded-lg">
    Checkout
  </button>
</div>

<!-- CART DRAWER -->
<div id="cartDrawer"
  class="fixed inset-0 bg-white z-50 transform translate-x-full transition duration-300 overflow-y-auto">

  <div class="p-4">
    <h2 class="text-xl font-bold mb-4">Your Cart</h2>
    <div id="cartItems"></div>

    <div class="border-t pt-4 mt-4">
      <h3 class="font-bold text-lg">
        Total: ‚Çπ<span id="totalAmount">0</span>
      </h3>
    </div>

    <!-- Customer Info -->
    <div class="mt-4 space-y-2">
      <input id="custName" placeholder="Full Name"
        class="w-full p-3 border rounded">
      <input id="custPhone" placeholder="Phone Number"
        class="w-full p-3 border rounded">
      <input id="custAddress" placeholder="Delivery Address"
        class="w-full p-3 border rounded">

      <button onclick="getLocation()" 
        class="w-full bg-blue-600 text-white py-2 rounded">
        üìç Use My Location
      </button>

      <p id="locationStatus" class="text-sm text-green-600"></p>
    </div>

    <button onclick="placeOrder()"
      class="w-full mt-4 bg-green-600 text-white py-3 rounded-lg text-lg">
      Place Order
    </button>

    <button onclick="toggleCart()"
      class="w-full mt-2 bg-gray-300 py-2 rounded">
      Close
    </button>
  </div>
</div>

<script>

/* DEMO PRODUCTS */
const PRODUCTS = [
  {id:1,name:"Nandini Milk",price:24,category:"Dairy",image:"https://images.unsplash.com/photo-1580910051074-3eb694886505"},
  {id:2,name:"Banana",price:40,category:"Fruits",image:"https://images.unsplash.com/photo-1574226516831-e1dff420e43e"},
  {id:3,name:"Tomato",price:30,category:"Vegetables",image:"https://images.unsplash.com/photo-1546470427-e26264be0b30"},
  {id:4,name:"Rice (1kg)",price:60,category:"Grains",image:"https://images.unsplash.com/photo-1586201375761-83865001e31c"},
  {id:5,name:"Coca Cola",price:40,category:"Beverages",image:"https://images.unsplash.com/photo-1580910051074-3eb694886505"},
  {id:6,name:"Maggi Noodles",price:14,category:"Snacks",image:"https://images.unsplash.com/photo-1617196039897-7c04d2c2c16c"}
];

let cart = {};
let selectedCategory = "All";
let locationLink = "";

const grid = document.getElementById("productGrid");
const chips = document.getElementById("categoryChips");

/* CATEGORY CHIPS */
const categories = ["All", ...new Set(PRODUCTS.map(p=>p.category))];

categories.forEach(cat=>{
  chips.innerHTML += `
    <button onclick="filterCategory('${cat}')"
      class="px-4 py-2 bg-gray-200 rounded-full text-sm whitespace-nowrap">
      ${cat}
    </button>
  `;
});

function filterCategory(cat){
  selectedCategory = cat;
  renderProducts();
}

/* RENDER PRODUCTS */
function renderProducts(){
  grid.innerHTML="";
  let search=document.getElementById("searchInput").value.toLowerCase();

  PRODUCTS
    .filter(p=>
      (selectedCategory==="All"||p.category===selectedCategory) &&
      p.name.toLowerCase().includes(search)
    )
    .forEach(p=>{
      grid.innerHTML+=`
        <div class="bg-white rounded-xl shadow hover:shadow-lg transition">
          <img src="${p.image}" class="h-32 w-full object-cover rounded-t-xl">
          <div class="p-3">
            <h3 class="font-semibold text-sm">${p.name}</h3>
            <p class="text-gray-600 text-sm">‚Çπ${p.price}</p>
            <button onclick="addToCart(${p.id})"
              class="mt-2 w-full bg-blue-600 text-white py-1 rounded">
              Add
            </button>
          </div>
        </div>
      `;
    });
}

document.getElementById("searchInput")
  .addEventListener("input",renderProducts);

/* CART */
function addToCart(id){
  let product=PRODUCTS.find(p=>p.id===id);
  if(cart[id]) cart[id].qty++;
  else cart[id]={...product,qty:1};
  updateCart();
}

function updateCart(){
  let total=0,count=0;
  let cartDiv=document.getElementById("cartItems");
  cartDiv.innerHTML="";

  Object.values(cart).forEach(item=>{
    total+=item.price*item.qty;
    count+=item.qty;

    cartDiv.innerHTML+=`
      <div class="flex justify-between border-b py-2">
        <span>${item.name} x${item.qty}</span>
        <span>‚Çπ${item.price*item.qty}</span>
      </div>
    `;
  });

  document.getElementById("totalAmount").innerText=total;
  document.getElementById("mobileTotal").innerText=total;
  document.getElementById("cartCount").innerText=count;
}

function toggleCart(){
  document.getElementById("cartDrawer")
    .classList.toggle("translate-x-full");
}

/* LOCATION */
function getLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(position=>{
      let lat=position.coords.latitude;
      let lon=position.coords.longitude;
      locationLink=`https://maps.google.com/?q=${lat},${lon}`;
      document.getElementById("locationStatus").innerText="Location Added ‚úì";
    });
  }
}

/* ORDER */
function placeOrder(){
  let name=document.getElementById("custName").value;
  let phone=document.getElementById("custPhone").value;
  let address=document.getElementById("custAddress").value;

  if(!name||!phone||!address){
    alert("Fill all details");
    return;
  }

  let message="üõí *New Order - Vemagal Quick-Mart*\n\n";

  Object.values(cart).forEach((item,i)=>{
    message+=`${i+1}. ${item.name} x${item.qty}\n`;
  });

  message+=`\nTotal: ‚Çπ${document.getElementById("totalAmount").innerText}`;
  message+=`\nCustomer: ${name}`;
  message+=`\nPhone: ${phone}`;
  message+=`\nAddress: ${address}`;

  if(locationLink){
    message+=`\nLocation: ${locationLink}`;
  }

  window.open(
    `https://wa.me/919381487396?text=${encodeURIComponent(message)}`
  );
}

renderProducts();

</script>
</body>
</html>